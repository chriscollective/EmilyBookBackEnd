<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <title>Emily Books Agency</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link
      rel="icon"
      type="image/x-icon"
      href="/Images/Index_images/favicon.png"
    />
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="/Scripts/blockUI.js" type="text/javascript"></script>
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css"
    />
    <!-- CSS Link -->
    <link rel="stylesheet" href="./NewCss/base.css" />
    <link rel="stylesheet" href="./NewCss/layout.css" />
    <link rel="stylesheet" href="./NewCss/modules.css" />

    <script type="text/javascript">
      // --------------------------------------------------
      // ğŸ”„ æ¨¡å¼åˆ‡æ›ï¼štrue = å‡è³‡æ–™æ¨¡å¼ï¼›false = æ­£å¸¸é€£ç·š
      // --------------------------------------------------
      var isMockMode = true;

      // --------------------------------------------------
      // ğŸ§­ å¾ç¶²å€æŠ“ UID
      // --------------------------------------------------
      function getQueryParam(name) {
        const urlParams = new URLSearchParams(window.location.search);
        return urlParams.get(name);
      }
      var UID = getQueryParam("UID") || "0";

      // --------------------------------------------------
      // ğŸ§© å‡è³‡æ–™åº«
      // --------------------------------------------------
      const mockCatalogs = [
        {
          UID: "1",
          CatalogName: "Spring 2025 Fiction",
          CatalogYear: "2025",
          Create_Who2: "Emily Chen",
          Craete_When2: "2025/03/15",
        },
        {
          UID: "2",
          CatalogName: "Childrenâ€™s Picture Books",
          CatalogYear: "2024",
          Create_Who2: "Michael Wang",
          Craete_When2: "2024/11/02",
        },
        {
          UID: "3",
          CatalogName: "Global Non-Fiction",
          CatalogYear: "2023",
          Create_Who2: "Lisa Huang",
          Craete_When2: "2023/09/18",
        },
        {
          UID: "4",
          CatalogName: "Asian Literary Highlights",
          CatalogYear: "2025",
          Create_Who2: "Kenji Arai",
          Craete_When2: "2025/01/20",
        },
        {
          UID: "5",
          CatalogName: "Award-Winning Titles",
          CatalogYear: "2022",
          Create_Who2: "Sophia Lin",
          Craete_When2: "2022/12/10",
        },
      ];

      // --------------------------------------------------
      // ğŸ§  ä¸»å‡½å¼ï¼šè¼‰å…¥è³‡æ–™
      // --------------------------------------------------
      function GetData() {
        if (isMockMode) {
          console.log("ğŸ§© å‡è³‡æ–™æ¨¡å¼å•Ÿå‹•ä¸­ (UID=" + UID + ")");
          if (UID === "0") {
            $(".TitleofThisPage").text("Create New Catalog");
            $("#CatalogName").val("");
            $("#CatalogYear").val("");
            return;
          }

          const rw = mockCatalogs.find((c) => c.UID === UID);
          if (rw) {
            $("#CatalogName").val(rw.CatalogName);
            $("#CatalogYear").val(rw.CatalogYear);
            $(".TitleofThisPage").text("Edit Catalog");
          } else {
            alert("æœªæ‰¾åˆ°å°æ‡‰çš„å‡è³‡æ–™ UID=" + UID);
          }
          return;
        }

        // ğŸš€ çœŸå¯¦é€£ç·šæ¨¡å¼
        $.post(
          "/Catalogs/CatalogLib.aspx",
          { Proc: "GetCatalogData", UID: UID },
          function (data) {
            var tb = $.parseJSON(data);
            if (tb.length > 0) {
              var rw = tb[0];
              $("#CatalogName").val(rw.CatalogName);
              $("#CatalogYear").val(rw.CatalogYear);
            }
          }
        );
      }

      // --------------------------------------------------
      // âœï¸ æ›´æ–°è³‡æ–™
      // --------------------------------------------------
      function UpdateData() {
        var obj = {};
        $(".fields").each(function () {
          obj[this.id] = $(this).val();
        });
        obj.UID = UID;

        if (isMockMode) {
          console.log("ğŸ§© æ¨¡æ“¬æ›´æ–°ï¼š", obj);
          alert(
            UID === "0"
              ? "ğŸ“˜ æ¨¡æ“¬æ–°å¢æˆåŠŸï¼(æœªé€å‡ºä¼ºæœå™¨)"
              : "âœï¸ æ¨¡æ“¬ä¿®æ”¹æˆåŠŸï¼(æœªé€å‡ºä¼ºæœå™¨)"
          );
          return;
        }

        $.post(
          "/Catalogs/CatalogLib.aspx",
          { Proc: "UpdateCatalogData", jsonString: JSON.stringify(obj) },
          function (data) {
            var obj = $.parseJSON(data);
            alert(obj.Message);
            if (obj.Success && UID == "0") {
              UID = obj.UID.toString();
            }
          }
        );
      }

      // --------------------------------------------------
      // ğŸ—‘ï¸ åˆªé™¤è³‡æ–™
      // --------------------------------------------------
      function UpdateCatalogDelData() {
        if (isMockMode) {
          if (confirm("ç¢ºå®šè¦åˆªé™¤é€™ç­†å‡è³‡æ–™å—ï¼Ÿ")) {
            alert("ğŸ—‘ï¸ æ¨¡æ“¬åˆªé™¤æˆåŠŸï¼ï¼ˆå‡è³‡æ–™æ¨¡å¼ä¸æœƒçœŸçš„åˆªé™¤ï¼‰");
            window.location.href = "./CatalogCreateSearch.html";
          }
          return;
        }

        if (confirm("Are you sure you want to delete?")) {
          $.post(
            "/Catalogs/CatalogLib.aspx",
            { Proc: "UpdateCatalogDeleteData", UID: UID },
            function (data) {
              var obj = $.parseJSON(data);
              alert(obj.Message);
              if (obj.Success) {
                window.location = "./CatalogCreateSearch.html";
              }
            }
          );
        }
      }

      // --------------------------------------------------
      // ğŸš€ åˆå§‹åŒ–
      // --------------------------------------------------
      $(document).ready(function () {
        GetData();
      });
    </script>
  </head>
  <body>
    <div class="topnav">
      <div class="AccountInfoCss">
        Welcome <span id="FullName">Emily</span>
        <button class="LogOutButtonCss" onclick="logout()">Log Out</button>
      </div>

      <div class="navbar">
        <div class="LogoWrap">
          <a href="https://www.emilybooksagency.com/index.aspx">
            <img src="./image/EmilyAgencyLogo.png" class="Site_Title_Logo" />
          </a>
        </div>
        <div class="PageNav_Wrap">
          <a href="./index.html">Book List</a>
          <a href="./PublishedAuthorCreateUpdateSearch.html">Author List</a>
          <a href="./PublishedCoAgentsCreateUpdate.html">CoAgents List</a>
          <a href="./CatalogCreateSearch.html">Catalog List</a>
          <a href="./AboutEmilyCreateSearch.html">Emily Info Edit</a>
        </div>
      </div>
    </div>

    <div class="main">
      <div class="MainTitleDesc TitleofThisPage">Catalog Information</div>

      <a onclick="UpdateCatalogDelData();" class="DelPubButtonCss">Delete</a>
      <a class="BacktoListCss" href="./CatalogCreateSearch.html">Go back</a>

      <div class="row">
        <div class="col-50">
          <div class="container">
            <div class="row">
              <div class="col-50">
                <label for="CatalogName"> Catalog Name</label>
                <input
                  type="text"
                  id="CatalogName"
                  class="fields"
                  name="CatalogName"
                />

                <label for="CatalogYear"> Catalog Year</label>
                <input
                  type="text"
                  id="CatalogYear"
                  class="fields"
                  name="CatalogYear"
                />
              </div>
            </div>

            <div class="save-container">
              <button class="SubmitBTN btn" onclick="UpdateData();">
                Save Changes
              </button>
            </div>
          </div>
        </div>
      </div>
    </div>
  </body>
</html>
